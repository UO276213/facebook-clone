---
import Layout from "../layouts/Layout.astro";
import PostList from "../components/PostCardList";
import UserDetailsCard from "../components/UserDetailsCard";
import ProfileHeader from "../components/ProfileHeader";
import ProfileNavBar from "../components/ProfileNavBar";

export const prerender = false;

const loggedUserId = Astro.cookies.get("loggedUser")?.value
const {origin, searchParams} = Astro.url

const userLogged = await fetch(`${origin}/api/users?id=${loggedUserId}`).then(res => res.json())
let userProfile = userLogged;
if (searchParams.get("id")) {
  const userVisited = await fetch(`${origin}/api/users?id=${searchParams.get("id")}`).then(res => res.ok && res.json())
  if (userVisited)
    userProfile = userVisited;
}
const posts = await fetch(`${origin}/api/posts`).then(res => res.json())
---

<Layout title="Facebook">
  <ProfileHeader user={userProfile} />
  <ProfileNavBar/>
  <main class="flex place-content-center">
    <div class="w-4/6 py-4 px-8">
      <div class="flex gap-4 place-content-center">
        <div class="flex flex-col w-2/5 sticky top-20 h-fit gap-4">
          <UserDetailsCard />
        </div>
        <div class="w-3/5">
          <PostList client:load user={userLogged} posts={posts} />
        </div>
      </div>
    </div>
  </main>
</Layout>
